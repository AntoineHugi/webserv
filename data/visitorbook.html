<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Visitor Book</title>

	<style>
		body {
			font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
			padding: 24px;
			max-width: 900px;
			margin: auto;
		}

		form {
			display: flex;
			gap: 8px;
			align-items: center;
			flex-wrap: wrap;
		}

		input {
			padding: 8px 10px;
			font-size: 16px;
			border: 1px solid #ccc;
			border-radius: 6px;
		}

		button {
			padding: 8px 12px;
			font-size: 16px;
			border-radius: 6px;
			cursor: pointer;
		}

		p {
			margin-top: 20px;
			font-size: 14px;
			color: #444;
		}
	</style>
</head>

<body>

	<h1>Visitor Book</h1>

	<form id="signForm" method="post" action="/visitorbook/signing/signing.csv" target="hidden_iframe" novalidate>
		<input id="firstName" name="firstName" type="text" placeholder="First Name" required />
		<input id="lastName" name="lastName" type="text" placeholder="Last Name" required />
		<button type="submit">Sign</button>
	</form>

	<iframe name="hidden_iframe" style="display:none;"></iframe>

	<h2>Current Entries</h2>

	<table id="entriesTable">
		<thead>
			<tr>
				<th>First Name</th>
				<th>Last Name</th>
			</tr>
		</thead>
		<tbody></tbody>
	</table>

	<p><a href="/">‚Üê Back to Home</a></p>

	<script>
		async function loadCSV() {
			try {
				const res = await fetch('/visitorbook/signing/signing.csv', { cache: "no-store" });
				const text = await res.text();
				const lines = text.trim().split(/\r?\n/).slice(1); // skip header

				const tbody = document.querySelector('#entriesTable tbody');
				tbody.innerHTML = '';

				for (const line of lines) {
					const [first, last] = line.split(',');
					if (!first || !last) continue;

					const tr = document.createElement('tr');
					tr.innerHTML = `<td>${first}</td><td>${last}</td>`;
					tbody.appendChild(tr);
				}
			} catch (err) {
				console.error("CSV load error:", err);
			}
		}

		loadCSV();

		const form = document.getElementById('signForm');
		const firstNameInput = document.getElementById('firstName');
		const lastNameInput = document.getElementById('lastName');

		form.addEventListener('submit', function (ev) {
			if (!firstNameInput.value.trim() || !lastNameInput.value.trim()) {
				alert('Both First Name and Last Name are required.');
				ev.preventDefault();
				return;
			}

			setTimeout(() => {
				loadCSV()
				firstNameInput.value = '';
				lastNameInput.value = '';
				firstNameInput.focus();
			}, 100);
		});
	</script>

</body>

</html>